@model RestaurantManagement.ViewModel.RegisterVM

@{
    ViewData["Title"] = "Create Account";
}

<section class="min-vh-100 d-flex align-items-center justify-content-center bg-light py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
                    <div class="card-header bg-primary text-white text-center py-4">
                        <i class="bi bi-person-plus display-5 d-block mb-3"></i>
                        <h2 class="fw-bold mb-1">Join Our Family</h2>
                        <small>Create your account and start ordering</small>
                    </div>

                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4 position-relative">
                            <div class="progress w-100 position-absolute top-50 start-0 translate-middle-y" style="height:4px;">
                                <div class="progress-bar bg-primary" style="width:33%;"></div>
                            </div>
                            <div class="rounded-circle bg-primary text-white text-center z-1" style="width:30px; height:30px; line-height:30px;">1</div>
                            <div class="rounded-circle bg-light text-secondary text-center z-1" style="width:30px; height:30px; line-height:30px;">2</div>
                            <div class="rounded-circle bg-light text-secondary text-center z-1" style="width:30px; height:30px; line-height:30px;">3</div>
                        </div>

                        <form asp-action="Register" method="post" id="registerForm">
                            <div asp-validation-summary="All" class="alert alert-danger"></div>

                            <div class="mb-3">
                                <label asp-for="UserName" class="form-label fw-semibold">
                                    <i class="bi bi-person-fill me-2"></i>Username
                                </label>
                                <input asp-for="UserName" class="form-control" placeholder="Choose a username" />
                                <span asp-validation-for="UserName" class="text-danger small"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Email" class="form-label fw-semibold">
                                    <i class="bi bi-envelope-fill me-2"></i>Email Address
                                </label>
                                <input asp-for="Email" class="form-control" placeholder="Enter your email" />
                                <span asp-validation-for="Email" class="text-danger small"></span>
                            </div>

                            <div class="mb-3 position-relative">
                                <label asp-for="Password" class="form-label fw-semibold">
                                    <i class="bi bi-lock-fill me-2"></i>Password
                                </label>
                                <input asp-for="Password" type="password" class="form-control pe-5" placeholder="Create a password" id="password" />
                                <button type="button" class="btn btn-link position-absolute top-50 end-0 translate-middle-y me-3 p-0 text-secondary" id="togglePassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <span asp-validation-for="Password" class="text-danger small"></span>

                                <div class="progress mt-2" style="height:5px;">
                                    <div id="passwordStrength" class="progress-bar"></div>
                                </div>

                                <ul class="list-unstyled small mt-2 mb-0 text-muted">
                                    <li id="reqLength"><i class="bi bi-dot"></i> At least 8 characters</li>
                                    <li id="reqUpper"><i class="bi bi-dot"></i> One uppercase letter</li>
                                    <li id="reqLower"><i class="bi bi-dot"></i> One lowercase letter</li>
                                    <li id="reqNumber"><i class="bi bi-dot"></i> One number</li>
                                </ul>
                            </div>

                            <div class="mb-3 position-relative">
                                <label asp-for="ConfirmPassword" class="form-label fw-semibold">
                                    <i class="bi bi-lock-fill me-2"></i>Confirm Password
                                </label>
                                <input asp-for="ConfirmPassword" type="password" class="form-control pe-5" placeholder="Confirm your password" id="confirmPassword" />
                                <button type="button" class="btn btn-link position-absolute top-50 end-0 translate-middle-y me-3 p-0 text-secondary" id="toggleConfirmPassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Address" class="form-label fw-semibold">
                                    <i class="bi bi-geo-alt-fill me-2"></i>Delivery Address
                                </label>
                                <input asp-for="Address" class="form-control" placeholder="Enter your delivery address" />
                                <span asp-validation-for="Address" class="text-danger small"></span>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 fw-semibold py-2" id="registerBtn">
                                <i class="bi bi-person-plus-fill me-2"></i>Create Account
                            </button>
                        </form>

                        <div class="text-center border-top mt-4 pt-3">
                            <p class="text-muted mb-2">Already have an account?</p>
                            <a asp-controller="Account" asp-action="Login" class="btn btn-outline-primary w-100 fw-semibold">
                                <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
                            </a>
                        </div>

                        <div class="mt-4 bg-light p-3 rounded">
                            <h6 class="fw-semibold text-primary mb-2"><i class="bi bi-gift-fill me-2"></i>Join Now & Get</h6>
                            <ul class="list-unstyled small text-muted mb-0">
                                <li><i class="bi bi-check-circle-fill text-success me-2"></i>10% off your first order</li>
                                <li><i class="bi bi-check-circle-fill text-success me-2"></i>Exclusive member deals</li>
                                <li><i class="bi bi-check-circle-fill text-success me-2"></i>Faster checkout</li>
                                <li><i class="bi bi-check-circle-fill text-success me-2"></i>Order history tracking</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        const togglePassword = document.getElementById('togglePassword');
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirmPassword');
        const strengthBar = document.getElementById('passwordStrength');

        togglePassword.addEventListener('click', () => toggleVisibility(password, togglePassword));
        toggleConfirmPassword.addEventListener('click', () => toggleVisibility(confirmPassword, toggleConfirmPassword));

        function toggleVisibility(input, button) {
            const isHidden = input.getAttribute('type') === 'password';
            input.setAttribute('type', isHidden ? 'text' : 'password');
            button.innerHTML = isHidden ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
        }

        password.addEventListener('input', () => {
            const val = password.value;
            const hasLength = val.length >= 8;
            const hasUpper = /[A-Z]/.test(val);
            const hasLower = /[a-z]/.test(val);
            const hasNumber = /[0-9]/.test(val);

            updateReq('reqLength', hasLength);
            updateReq('reqUpper', hasUpper);
            updateReq('reqLower', hasLower);
            updateReq('reqNumber', hasNumber);

            let strength = hasLength + hasUpper + hasLower + hasNumber;
            strengthBar.className = 'progress-bar';
            if (strength <= 1) strengthBar.classList.add('bg-danger', 'w-25');
            else if (strength <= 3) strengthBar.classList.add('bg-warning', 'w-50');
            else strengthBar.classList.add('bg-success', 'w-100');
        });

        function updateReq(id, ok) {
            const el = document.getElementById(id);
            el.classList.toggle('text-success', ok);
            el.classList.toggle('text-muted', !ok);
            el.querySelector('i').className = ok ? 'bi bi-check-circle-fill text-success me-1' : 'bi bi-dot me-1';
        }

        document.getElementById('registerForm').addEventListener('submit', e => {
            const btn = document.getElementById('registerBtn');
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Creating Account...';
            btn.disabled = true;
        });
    </script>
}
